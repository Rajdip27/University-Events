@using UniversityEvents.Application.Services
@using UniversityEvents.Infrastructure.Healper.Acls
@model UniversityEvents.Application.CommonModel.PaginationModel<UniversityEvents.Core.Entities.PaymentHistory>
@inject ISignInHelper SignInHelper
@inject IRolePermissionService RolePermissionService
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    string currentSearch = Context.Request.Query["search"];
    int sl = ((Model.PageNumber - 1) * Model.PageSize) + 1;
    var role = SignInHelper.Roles;
}

<style>
    /* ===== SMART TABLE CONTAINER ===== */
    .smart-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
    }

    /* ===== TABLE ===== */
    .smart-table {
        margin-bottom: 0;
        font-size: 14px;
        border-collapse: separate;
        border-spacing: 0;
    }

        .smart-table thead th {
            background: #f9fafb;
            color: #111827;
            font-weight: 600;
            padding: 12px 14px;
            border-bottom: 2px solid #e5e7eb;
            border-top: none;
        }

        .smart-table th,
        .smart-table td {
            border-right: 1px solid #e5e7eb;
        }

            .smart-table th:last-child,
            .smart-table td:last-child {
                border-right: none;
            }

        .smart-table tbody td {
            padding: 12px 14px;
            border-bottom: 1px solid #e5e7eb;
            color: #374151;
            vertical-align: middle;
        }

        .smart-table tbody tr:hover {
            background: #f3f4f6;
        }

    /* ===== ACTION BUTTONS ===== */
    .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid transparent;
    }

    .action-edit {
        color: #2563eb;
        border-color: #dbeafe;
        background: #eff6ff;
    }

        .action-edit:hover {
            background: #2563eb;
            color: #ffffff;
            border-color: #2563eb;
        }

    .action-delete {
        color: #dc2626;
        border-color: #fee2e2;
        background: #fef2f2;
    }

        .action-delete:hover {
            background: #dc2626;
            color: #ffffff;
            border-color: #dc2626;
        }

    /* ===== HEADER ===== */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        flex-wrap: wrap;
        gap: 10px;
    }

        .page-header h4 {
            margin: 0;
            font-weight: 600;
        }

        .page-header small {
            color: #6b7280;
        }
</style>

<div class="content-area">

    <!-- PAGE HEADER -->
    <div class="page-header">
        <div>
            <h4>Payment History List</h4>
            <small>Manage event Payment History</small>
        </div>

        <div class="d-flex gap-2">
            <form method="get" class="d-flex gap-2">
                <input type="text"
                       name="search"
                       class="form-control form-control-sm"
                       placeholder="Search..."
                       value="@currentSearch" />
                <button class="btn btn-outline-secondary btn-sm">
                    <i class="ri-search-line"></i>
                </button>
            </form>
            


        </div>
    </div>

    <!-- TABLE -->
    <div class="smart-card">
        <div class="table-responsive">
            <table class="table smart-table">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Invoice Number</th>
                        <th>Student Id Card</th>
                        <th>Student Name</th>
                        <th>Email</th>
                        <th>Event Name</th>
                        <th>Paid Amount</th>
                        <th>Bank Name</th>
                        <th>Transaction Id</th>
                        <th>Payment Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    @if (Model.Items.Any())
                    {
                        foreach (var item in Model.Items)
                        {
                            <tr>
                                <td>@sl</td>

                                <td>
                                    @item.Payment.InvoiceNumber
                                </td>

                                <td>
                                    @item.Payment.Registration.IdCardNumber
                                </td>

                                <td>
                                    @item.Payment.Registration.FullName
                                </td>
                                <td>
                                    @item.Payment.Registration.Email
                                </td>

                                <td>
                                    @item.Payment.Registration.Event.Name
                                </td>

                                <td>
                                    @item.Amount
                                </td>
                                <td>
                                    @item.BankName
                                </td>
                                <td>
                                    @item.TransactionId
                                </td>

                                <td>
									@item.CreatedDate.ToString("yyyy-MM-dd")
                                </td>
                                <td>
                                    @item.Payment.Registration.PaymentStatus
                                </td>

                                <td class="text-center">
                                    <div class="d-inline-flex gap-2">
                                        @if (@item.Payment.Registration.PaymentStatus == "Paid")
                                        {
                                            <a asp-controller="StudentRegistration"
                                            asp-action="PaidInvoice"
                                            asp-route-registerId="@item.Payment.RegistrationId"
                                            class="action-btn action-edit"
                                            title="Invoice">
                                                <i class="ri-file-text-line"></i>
                                            </a>
                                        }
                                    </div>
                                </td>
                            </tr>
                            sl++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="text-center py-4 text-muted">
                                No data found
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- PAGINATION -->
    <div class="d-flex justify-content-end mt-3">
        <partial name="_Pagination" model="Model" />
    </div>

</div>
